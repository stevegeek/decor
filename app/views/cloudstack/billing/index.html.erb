<% content_for :title, "CloudStack Pro - Billing" %>

<div class="container mx-auto px-4 py-6">
  <!-- Page Header -->
  <div class="mb-8">
    <%= render ::Decor::Title.new(text: "Billing & Usage", level: 1) %>
    <p class="text-gray-600 mt-2">Monitor your usage and manage billing information.</p>
  </div>

  <!-- Current Period Summary -->
  <div class="mb-8">
    <%= render ::Decor::Card.new(title: "Current Billing Period - #{@current_period[:period]}", size: :lg) do |card| %>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <!-- Current Charges -->
        <div class="text-center">
          <div class="text-3xl font-bold text-primary">${{ @current_period[:current_charges] }}</div>
          <div class="text-sm text-gray-600">Current Charges</div>
        </div>
        
        <!-- Projected Total -->
        <div class="text-center">
          <div class="text-3xl font-bold text-warning">${{ @current_period[:projected_total] }}</div>
          <div class="text-sm text-gray-600">Projected Total</div>
        </div>
        
        <!-- Usage Percentage -->
        <div class="text-center">
          <div class="text-3xl font-bold text-info"><%= @current_period[:usage_percentage] %>%</div>
          <div class="text-sm text-gray-600">Period Used</div>
        </div>
        
        <!-- Days Remaining -->
        <div class="text-center">
          <div class="text-3xl font-bold text-success"><%= @current_period[:days_remaining] %></div>
          <div class="text-sm text-gray-600">Days Remaining</div>
        </div>
      </div>
      
      <!-- Usage Progress Bar -->
      <div class="mt-6">
        <div class="flex justify-between text-sm mb-2">
          <span>Billing Period Progress</span>
          <span><%= @current_period[:usage_percentage] %>% complete</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-3">
          <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full" style="width: <%= @current_period[:usage_percentage] %>%"></div>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Usage Breakdown -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <!-- Service Breakdown -->
    <%= render ::Decor::Card.new(title: "Usage Breakdown", size: :lg) do |card| %>
      <div class="space-y-4">
        <% @usage_summary.each do |service, data| %>
          <div>
            <div class="flex justify-between items-center mb-2">
              <span class="font-medium capitalize"><%= service %></span>
              <span class="font-semibold">$<%= data[:cost] %></span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div class="bg-blue-600 h-2 rounded-full" style="width: <%= data[:percentage] %>%"></div>
            </div>
            <div class="text-sm text-gray-600 mt-1"><%= data[:percentage] %>% of total</div>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Recent Invoices -->
    <%= render ::Decor::Card.new(title: "Recent Invoices", size: :lg) do |card| %>
      <div class="space-y-3">
        <% @recent_invoices.each do |invoice| %>
          <div class="flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50">
            <div>
              <div class="font-medium"><%= invoice[:id] %></div>
              <div class="text-sm text-gray-600"><%= invoice[:date].strftime("%B %d, %Y") %></div>
            </div>
            <div class="text-right">
              <div class="font-semibold">$<%= invoice[:amount] %></div>
              <%= render ::Decor::Badge.new(
                text: invoice[:status].humanize,
                color: invoice[:status] == 'paid' ? :success : :warning,
                size: :small
              ) %>
            </div>
          </div>
        <% end %>
      </div>
      
      <div class="mt-4 pt-4 border-t">
        <%= render ::Decor::Link.new(
          href: cloudstack_billing_history_path,
          text: "View full billing history â†’"
        ) %>
      </div>
    <% end %>
  </div>

  <!-- Quick Actions -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <%= render ::Decor::Card.new(size: :md) do |card| %>
      <div class="text-center">
        <%= render ::Decor::Icon.new(name: "chart-bar", html_options: {class: "mx-auto h-12 w-12 text-blue-600 mb-4"}) %>
        <%= render ::Decor::Title.new(text: "Detailed Usage", level: 4, html_options: {class: "text-center mb-2"}) %>
        <p class="text-gray-600 text-sm mb-4">View detailed usage analytics and trends</p>
        <%= render ::Decor::Button.new(
          label: "View Usage",
          color: :primary,
          variant: :outlined,
          full_width: true,
          element_tag: :a
        ) %>
      </div>
    <% end %>

    <%= render ::Decor::Card.new(size: :md) do |card| %>
      <div class="text-center">
        <%= render ::Decor::Icon.new(name: "document-text", html_options: {class: "mx-auto h-12 w-12 text-green-600 mb-4"}) %>
        <%= render ::Decor::Title.new(text: "Billing History", level: 4, html_options: {class: "text-center mb-2"}) %>
        <p class="text-gray-600 text-sm mb-4">Access all your invoices and payment history</p>
        <%= render ::Decor::Button.new(
          label: "View History",
          color: :success,
          variant: :outlined,
          full_width: true,
          element_tag: :a
        ) %>
      </div>
    <% end %>

    <%= render ::Decor::Card.new(size: :md) do |card| %>
      <div class="text-center">
        <%= render ::Decor::Icon.new(name: "credit-card", html_options: {class: "mx-auto h-12 w-12 text-purple-600 mb-4"}) %>
        <%= render ::Decor::Title.new(text: "Payment Methods", level: 4, html_options: {class: "text-center mb-2"}) %>
        <p class="text-gray-600 text-sm mb-4">Manage your payment methods and billing info</p>
        <%= render ::Decor::Button.new(
          label: "Manage",
          color: :secondary,
          variant: :outlined,
          full_width: true,
          element_tag: :a
        ) %>
      </div>
    <% end %>
  </div>

  <!-- Cost Alert Banner -->
  <div class="mt-8">
    <%= render ::Decor::Banner.new(
      color: :info,
      variant: :outlined,
      dismissible: true
    ) do %>
      <%= render ::Decor::Icon.new(name: "information-circle", html_options: {class: "h-5 w-5 mr-2"}) %>
      You're currently at 78% of your monthly budget. Consider setting up cost alerts to monitor usage.
      <%= render ::Decor::Link.new(
        href: cloudstack_settings_path,
        text: "Configure alerts",
        html_options: {class: "ml-2 underline"}
      ) %>
    <% end %>
  </div>
</div>