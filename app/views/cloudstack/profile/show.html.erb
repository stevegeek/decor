<% content_for :title, "CloudStack Pro - Profile" %>

<div class="container mx-auto px-4 py-6">
  <!-- Page Header -->
  <div class="mb-8">
    <%= render ::Decor::Title.new(text: "User Profile", level: 1) %>
    <p class="text-gray-600 mt-2">Manage your account information and preferences.</p>
  </div>

  <!-- Profile Information -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
    <!-- Profile Card -->
    <div class="lg:col-span-1">
      <%= render ::Decor::Card.new(title: "Profile", size: :lg) do |card| %>
        <div class="text-center">
          <%= render ::Decor::Avatar.new(
            src: @user[:avatar_url],
            alt: @user[:name],
            size: :xl,
            html_options: {class: "mx-auto mb-4"}
          ) %>
          
          <%= render ::Decor::Title.new(text: @user[:name], level: 3, html_options: {class: "text-center"}) %>
          <p class="text-gray-600 text-center"><%= @user[:email] %></p>
          
          <div class="flex justify-center mt-4">
            <%= render ::Decor::Badge.new(
              text: @user[:account_tier],
              color: :primary,
              size: :large
            ) %>
          </div>
          
          <div class="mt-6">
            <%= render ::Decor::Button.new(
              label: "Edit Profile",
              color: :primary,
              variant: :outlined,
              icon: "pencil",
              full_width: true,
              element_tag: :a
            ) %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Profile Details -->
    <div class="lg:col-span-2">
      <%= render ::Decor::Tabs.new(default_tab: "details") do |tabs| %>
        <% tabs.tab(id: "details", label: "Details") do %>
          <%= render ::Decor::Card.new(title: "Account Information", size: :lg) do |card| %>
            <div class="space-y-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700">Full Name</label>
                  <input type="text" value="<%= @user[:name] %>" class="input input-bordered w-full mt-1" readonly>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Email</label>
                  <input type="email" value="<%= @user[:email] %>" class="input input-bordered w-full mt-1" readonly>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Role</label>
                  <input type="text" value="<%= @user[:role] %>" class="input input-bordered w-full mt-1" readonly>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Timezone</label>
                  <select class="select select-bordered w-full mt-1">
                    <option>UTC</option>
                    <option>America/New_York</option>
                    <option>America/Los_Angeles</option>
                    <option>Europe/London</option>
                  </select>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>

        <% tabs.tab(id: "security", label: "Security") do %>
          <%= render ::Decor::Card.new(title: "Security Settings", size: :lg) do |card| %>
            <div class="space-y-6">
              <!-- Password Section -->
              <div>
                <div class="flex justify-between items-center mb-4">
                  <div>
                    <h4 class="text-lg font-medium">Password</h4>
                    <p class="text-sm text-gray-600">Last changed 1 month ago</p>
                  </div>
                  <%= render ::Decor::Button.new(
                    label: "Change Password",
                    color: :secondary,
                    variant: :outlined,
                    size: :small
                  ) %>
                </div>
              </div>

              <!-- 2FA Section -->
              <div class="border-t pt-6">
                <div class="flex justify-between items-center mb-4">
                  <div>
                    <h4 class="text-lg font-medium">Two-Factor Authentication</h4>
                    <p class="text-sm text-gray-600">Add an extra layer of security to your account</p>
                  </div>
                  <%= render ::Decor::Badge.new(text: "Enabled", color: :success) %>
                </div>
                <%= render ::Decor::Button.new(
                  label: "Manage 2FA",
                  color: :neutral,
                  variant: :outlined,
                  size: :small
                ) %>
              </div>

              <!-- API Keys Section -->
              <div class="border-t pt-6">
                <div class="flex justify-between items-center mb-4">
                  <h4 class="text-lg font-medium">API Keys</h4>
                  <%= render ::Decor::Button.new(
                    label: "Generate New Key",
                    color: :primary,
                    size: :small,
                    icon: "plus"
                  ) %>
                </div>
                
                <div class="space-y-3">
                  <% @user[:api_keys].each do |api_key| %>
                    <div class="flex items-center justify-between p-3 border rounded-lg">
                      <div>
                        <div class="font-medium"><%= api_key[:name] %></div>
                        <div class="text-sm text-gray-600 font-mono">
                          <%= api_key[:key][0..16] %>...
                          <%= render ::Decor::ClickToCopy.new(text: api_key[:key], html_options: {class: "ml-2"}) %>
                        </div>
                        <div class="text-xs text-gray-500">Created <%= api_key[:created_at].strftime("%B %d, %Y") %></div>
                      </div>
                      <%= render ::Decor::Button.new(
                        label: "Revoke",
                        color: :danger,
                        variant: :text,
                        size: :small
                      ) %>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>

        <% tabs.tab(id: "notifications", label: "Notifications") do %>
          <%= render ::Decor::Card.new(title: "Notification Preferences", size: :lg) do |card| %>
            <div class="space-y-6">
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-medium">Email Alerts</div>
                  <div class="text-sm text-gray-600">Receive important notifications via email</div>
                </div>
                <input type="checkbox" class="toggle toggle-primary" <%= 'checked' if @user[:notification_preferences][:email_alerts] %>>
              </div>
              
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-medium">SMS Alerts</div>
                  <div class="text-sm text-gray-600">Receive critical alerts via SMS</div>
                </div>
                <input type="checkbox" class="toggle toggle-primary" <%= 'checked' if @user[:notification_preferences][:sms_alerts] %>>
              </div>
              
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-medium">Desktop Notifications</div>
                  <div class="text-sm text-gray-600">Show browser notifications</div>
                </div>
                <input type="checkbox" class="toggle toggle-primary" <%= 'checked' if @user[:notification_preferences][:desktop_notifications] %>>
              </div>
            </div>
          <% end %>
        <% end %>

        <% tabs.tab(id: "activity", label: "Activity") do %>
          <%= render ::Decor::Card.new(title: "Recent Account Activity", size: :lg) do |card| %>
            <div class="space-y-4">
              <% @account_activity.each do |activity| %>
                <div class="flex items-center space-x-3 p-3 border-b last:border-b-0">
                  <%= render ::Decor::Icon.new(name: "clock", html_options: {class: "h-5 w-5 text-gray-400"}) %>
                  <div class="flex-1">
                    <div class="font-medium"><%= activity[:action] %></div>
                    <% if activity[:details] %>
                      <div class="text-sm text-gray-600"><%= activity[:details] %></div>
                    <% end %>
                    <% if activity[:ip] %>
                      <div class="text-sm text-gray-500">IP: <%= activity[:ip] %></div>
                    <% end %>
                  </div>
                  <div class="text-sm text-gray-500">
                    <%= time_ago_in_words(activity[:time]) %> ago
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>